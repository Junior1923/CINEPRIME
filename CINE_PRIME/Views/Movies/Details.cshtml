
@model CINE_PRIME.ViewModels.MovieDetailsViewModel

@{
    ViewData["Title"] = Model.Movie.Title;

    var backdrop = !string.IsNullOrEmpty(Model.Movie.BackdropPath)
        ? $"https://image.tmdb.org/t/p/original{Model.Movie.BackdropPath}"
        : "";

    var poster = $"https://image.tmdb.org/t/p/w500{Model.Movie.PosterPath}";
}

@section Styles {
    <link rel="stylesheet" href="~/css/peliculas.css" />
}

<div class="movie-details-page">

    <!-- HERO -->
    <section class="movie-hero"
             style="background-image: linear-gradient(180deg, rgba(6,10,14,0.6), rgba(6,10,14,0.85)),
                    url('@backdrop');">

        <div class="container movie-hero-inner d-flex gap-4">

            <!-- POSTER -->
            <div class="movie-hero-poster">
                <img src="@poster" alt="@Model.Movie.Title" class="movie-poster-img" />
            </div>

            <!-- INFO -->
            <div class="movie-hero-content text-light mt-5">

                <h1 class="movie-title">@Model.Movie.Title</h1>

                <div class="movie-meta-row">
                    <span class="rating">⭐ <strong>@Model.Movie.VoteAverage.ToString("0.0")</strong></span>
                    <span class="dot">•</span>
                    <span>@Model.Movie.ReleaseDate</span>
                </div>


                <!-- BOTONES -->
                <div class="movie-hero-actions mt-5 d-flex flex-wrap gap-2">
                    @if (User.Identity.IsAuthenticated)
                    {
                        <form asp-controller="Favorites" asp-action="Add" method="post" class="d-inline">
                            <input type="hidden" name="mediaId" value="@Model.Movie.Id" />
                            <input type="hidden" name="mediaType" value="movie" />
                            <button type="submit" class="btn btn-large btn-primary">
                                ❤️ Favorita
                            </button>
                        </form>

                        <form asp-controller="Watchlist" asp-action="Add" method="post" class="d-inline">
                            <input type="hidden" name="mediaId" value="@Model.Movie.Id" />
                            <input type="hidden" name="mediaType" value="movie" />
                            <button type="submit" class="btn btn-large btn-outline-light">
                                ➕ Ver más tarde
                            </button>
                        </form>
                    }
                    else
                    {
                        <a asp-controller="Account" asp-action="Login" class="btn btn-outline">
                            Inicia sesión para guardar
                        </a>
                    }
                </div>

            </div>
        </div>
    </section>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="container movie-main-body mt-5">

        <div class="row">

            <!-- IZQUIERDA -->
            <div class="col-lg-8">

                <section>
                    <h3 class="movie-section-title text-prime">Sinopsis</h3>
                    <p class="text-muted">@Model.Movie.Overview</p>
                </section>


                <!-- TRAILER -->
                @if (!string.IsNullOrEmpty(Model.TrailerKey))
                {
                    <section class="my-5">
                        <div class="movie-trailer-box mt-2">
                            <iframe src="@Model.TrailerKey" frameborder="0" allowfullscreen loading="lazy"></iframe>
                        </div>
                    </section>
                }
            </div>

            <!-- DERECHA -->
            <aside class="col-lg-4">
                <div class="movie-sticky-box">

                    <div class="movie-info-card">
                        <h4>Detalles</h4>
                        <ul class="list-unstyled text-muted">
                            <li><strong>Fecha de estreno:</strong> @Model.Movie.ReleaseDate</li>
                        </ul>
                    </div>

                    <div class="movie-info-card mt-3">
                        <h4>Acciones rápidas</h4>

                        @if (User.Identity.IsAuthenticated)
                        {
                            <div class="d-grid gap-2">

                                <form asp-controller="Favorites" asp-action="Add" method="post">
                                    <input type="hidden" name="mediaId" value="@Model.Movie.Id" />
                                    <input type="hidden" name="mediaType" value="movie" />
                                    <button class="btn btn-primary w-100">Añadir Favorita</button>
                                </form>

                                <form asp-controller="Watchlist" asp-action="Add" method="post">
                                    <input type="hidden" name="mediaId" value="@Model.Movie.Id" />
                                    <input type="hidden" name="mediaType" value="movie" />
                                    <button class="btn btn-outline w-100">Ver más tarde</button>
                                </form>

                            </div>
                        }
                        else
                        {
                            <a asp-controller="Account" asp-action="Login" class="btn btn-outline w-100">
                                Inicia sesión
                            </a>
                        }
                    </div>

                </div>
            </aside>

        </div>

        <div class="mt-4">
            <a asp-action="Index" class="btn btn-secondary justify-content-center">
                Volver al catálogo
            </a>
        </div>

    </main>
</div>
